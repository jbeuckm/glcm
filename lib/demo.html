<html>
  <head>
    <script src="https://twgljs.org/dist/twgl-full.min.js"></script>
    <script type="module">
      import './dist/main.js'

      let angle = Math.PI / 4,
        distance = 7

      const reach = 8,
        step = 4,
        levels = 16

      const glcm = GLCM.withOffscreenSize(256, 256)

      const update = () => {
        const fbi = glcm.findNeighbors({ angle, distance })
        const mfbi = glcm.buildMatrices(fbi, { reach, step, levels })
        const statsFbi = glcm.correlation(mfbi)
        glcm.display(statsFbi)

        const ib = glcm.getImageBitmap()

        const outputCanvas = document.getElementById('output')
        const outputCtx = outputCanvas.getContext('2d')
        outputCtx.drawImage(ib, 0, 0)
      }

      glcm.loadImage('./14896.jpg').then(async ({ image }) => {
        document.getElementById('original').appendChild(image)

        await glcm.init()

        update()
      })

      const distanceSlider = document.querySelector('#distance')
      distanceSlider.addEventListener('input', event => {
        distance = event.target.value

        update()
      })
      const angleSlider = document.querySelector('#angle')
      angleSlider.addEventListener('input', event => {
        angle = event.target.value

        update()
      })
    </script>
  </head>

  <body style="color: #fff; background-color: #000;">
    <div>
      angle
      <input
        type="range"
        id="angle"
        name="angle"
        min="0"
        max="3.142"
        value="0.7853981633974483"
        step="0.09817477042468103"
      />

      distance
      <input type="range" id="distance" name="distance" min="1" max="20" value="7" step=".5" />
    </div>

    <span id="original"> </span>

    <span>
      <canvas id="output" width="256" height="256"></canvas>
    </span>
  </body>
</html>
